<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if session['tname'] == 'operation' %}
{% extends 'sidebar.html' %}
{% block content %}
<script src="{{ url_for('static', filename='js/multiselect-dropdown.js') }}"></script>

<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    Serial Modal
                </div>
                <div class="card-body">
		<form method="POST" action="/your_form_action">
    <input type="hidden" name="tno" value="{{ tno }}">
    {% for material, serial_numbers in material_serial_dict.items() %}
    <div class="form-group">
        <label for="serialNumber_{{ material }}">
            Select Serial Number For {{ material }} Quantity ({{ vqty[material] }})
        </label>
        <select name="serialNumber_{{ material }}" multiple multiselect-search="true" class="form-control" data-quantity="{{ vqty[material] }}">
            {% for serial_number in serial_numbers %}
            <option value="{{ serial_number }}">{{ serial_number }}</option>
            {% endfor %}
        </select>
    </div>
    {% endfor %}
    <button type="submit" name="submit" class="btn btn-danger form-control">Approve</button>
</form>

                </div>
            </div>
        </div>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get all select elements
    const selectElements = document.querySelectorAll('select[multiple]');

    selectElements.forEach(select => {
        // Add change event listener to each select element
        select.addEventListener('change', function() {
            // Get the quantity from the data attribute
            const quantity = parseInt(select.getAttribute('data-quantity'), 10);
            // Get the number of selected options
            const selectedOptions = select.selectedOptions.length;

            // Check if the number of selected options exceeds the quantity
            if (selectedOptions > quantity) {
                alert(`You can only select up to ${quantity} serial numbers for this material.`);
                // Deselect the last selected option to enforce the limit
                select.selectedOptions[selectedOptions - 1].selected = false;
            }
                
	
        });
    });
});
</script>


{% endblock %}

{% else %}
<script>
 // Display a SweetAlert message and logout after 5 seconds
 window.onload = function() {
     Swal.fire({
         title: 'Access Denied!',
         text: 'You are not allowed to view this page.',
         icon: 'warning',
         timer: 5000, // Automatically close the alert after 5 seconds
         timerProgressBar: true,
         showConfirmButton: false
     }).then((result) => {
         // Redirect to logout page after the alert is closed
         if (result.dismiss === Swal.DismissReason.timer) {
             window.location.href = "/logout";
         }
     });
 };
</script>
{% endif %}
