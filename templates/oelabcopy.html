<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
{% if session['tname'] == "operation" %}
{% extends 'sidebar.html' %}
{% block content %}

<!-- CSS -->
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">i
<script src="{{ url_for('static', filename='js/multiselect-dropdown.js') }}"></script>
<style>
    .dropdown-menu {
        max-height: 200px; /* Adjust max-height as needed */
        overflow-y: auto;
    }
</style>

<div class="container-fluid">
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-white">External Demo  Dashboard</h1>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                class="fas fa-download fa-sm text-white-50"></i> Generate Report</a>
    </div>
    <div class="card mb-4">
	    <div class="card-header">
			 <i class="fas fa-certificate me-1"></i>
                                    Verify Material & Quantity
	    </div>
	    <div class="card-body">
			 <label>Select Material </label>
    <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle form-control" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false" style="background-color: white;color:black;">
            Select Material
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton" id="dropdownMenu">
            <input type="text" class="form-control" id="searchInput" placeholder="Search...">
            <li><hr class="dropdown-divider"></li>
            {% for iname in inventoryname %}
                <li><a class="dropdown-item material-option" href="#" data-material="{{ iname[3] }}">{{ iname[3] }}</a></li>
            {% endfor %}
        </ul>
    </div>
    <input type="hidden" name="material" id="materialInput">

	    </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
                                    <i class="fas fa-table me-1"></i>
                                    Add Lab
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-lg-2">
                                                <form action="{{ url_for('oelabadd') }}" method="post" id="materialForm">
                                            <label>Customer Name </label>
                                            <input type="text" name="cname" class="form-control" id="customerName">
                                        </div>
                                        <div class="col-lg-2">
                                            <label>Customer POC Name </label>
                                            <input type="text" name="cpocname" class="form-control" id="customerpocname">
                                        </div>
                                        <div class="col-lg-2">
                                            <label> Customer Phone No </label>
                                            <input type="number" name="cphone" class="form-control" id="cphone">
                                        </div>
                                        <div class="col-lg-2">
                                            <label>Customer Email Id </label>
                                            <input type="email" name="cemail" class="form-control" id="cemail">
                                        </div>
                                        <div class="col-lg-2">
                                            <label>Start Date </label>
                                            <input type="date" name="sdate" class="form-control" id="sdate">
                                            <script>
// Function to set the min attribute of the date input field to today's date
function setMinDate() {
    var today = new Date();
    var dd = String(today.getDate()).padStart(2, '0');
    var mm = String(today.getMonth() + 1).padStart(2, '0'); // January is 0!
    var yyyy = today.getFullYear();
    var minDate = yyyy + '-' + mm + '-' + dd;

    document.getElementById("sdate").setAttribute("min", minDate);
    document.getElementById("edate").setAttribute("min", minDate);
}

// Call the setMinDate function when the page loads
window.onload = setMinDate;
</script>
                                        </div>
                                         <div class="col-lg-2">
                                            <label>End Date </label>
                                            <input type="date" name="edate" class="form-control" id="edate">

                                         </div>

                                    </div><br>
                                    <div class="row">
                                            <br><br>    <div class="col-lg-3">
                                            <label>Requestor email </label>
                                            <input type="text" name="remail" class="form-control" id="remail">
                                         </div>

    <div class="modal fade" id="stockModal" tabindex="-1" aria-labelledby="stockModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="stockModalLabel">Stock Information</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p id="stockInfo"></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {

            $('.material-option').click(function() {
                var selectedOption = $(this).data("material");
                $.ajax({
                    type: 'POST',
                    url: '/oelab',
                    data: {'material': selectedOption},
                    success: function(response) {
                        var quantity = response.quantity;
                        if (quantity != 0) {
                            $('#stockInfo').text(selectedOption + ' is in stock and has ' + quantity + ' quantity.');
                        } else {
                            $('#stockInfo').text(selectedOption + ' is out of stock.');
                        }
                        $('#stockModal').modal('show');
                    },
                    error: function(xhr, status, error) {
                        alert('Error fetching quantity: ' + error);
                    }
                });
            });
            $('#stockModal').on('hidden.bs.modal', function () {
            $('#stockInfo').empty();
        });
        $('.material-option').click(function() {
            var selectedMaterial = $(this).data("material");
            $('#dropdownMenuButton').text(selectedMaterial);
            $('#materialInput').val(selectedMaterial);
        });
        $('#closeModalBtn').click(function() {
            $('#stockModal').modal('hide'); // Hide modal when "Close" button is clicked
        });
        });
    </script>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(document).ready(function() {
    $('#searchInput').on('input', function() {
        var searchText = $(this).val().toLowerCase();
        $('#dropdownMenu').find('.dropdown-item').each(function() {
            var text = $(this).text().toLowerCase();
            if (text.includes(searchText)) {
                $(this).show();
            } else {
                $(this).hide();
            }
        });
    });

    $('#dropdownMenu').on('click', '.dropdown-item', function(e) {
        var selectedItem = $(this).text();
        $('#dropdownMenuButton').text(selectedItem);
    });
});
</script>
			<div class="col-lg-4">
				 <label> Select Material   </label>
                                <select name="material" multiple multiselect-search="true" class="form-control" multiselect-select-all="true">
        {% for iname in inventoryname %}
	<option value="{{ iname[3] }}">{{ iname[3] }}  </option>
		 
            {% endfor %}
	  
</select>

			</div>
			<div class="col-lg-2">
				<label> Quantity  </label>
				<input type="text" name="quantity" class="form-control" title="Kindly enter quantity separated by commas" placeholder="Quantity separated by comma"> 
			</div>
			<div class="col-lg-2"><br>
	<div class="form-check">
    <input class="form-check-input" type="checkbox" id="exampleModalCheckbox">
    <label class="form-check-label" for="exampleModalCheckbox">
      Multi Material ?
    </label>
  </div>
</div>
<div class="col-lg-2">
    <br>

    <button class="form-control btn btn-danger">Add Demo</button>
    </form>
</div>

<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Multi Material Modal</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Display Customer Name and Email -->

        <!-- Additional Form Fields -->

	<div class="row">
		<div class="col-lg-6">
			
			<label> Select Material </label>
	 <select name="material[]" class="form-control">
        {% for iname in inventoryname %}
        <option value="{{ iname[3] }}">{{ iname[3] }}  </option>

            {% endfor %}

</select>
		</div>
		<div class="col-lg-4">
			<label> Quantity </label>
			 <input type="number" name="quantity[]" class="form-control" >

		</div>
		<div class="col-lg-2">
			<label> Add </label>
			 <button type="button" class="btn btn-primary btn-sm add-fields">+</button>
		</div>

</div>
<br>
<div id="additional-fields-container"></div>

<script>
    $(document).ready(function() {
        // Function to add new material and quantity fields
        function addFields() {
            var newFields = `
                <div class="row">
                    <div class="col-lg-6">
                        <select name="material[]" class="form-control">
                            {% for iname in inventoryname %}
                            <option value="{{ iname[3] }}">{{ iname[3] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-lg-4">
                        <input type="number" name="quantity[]" class="form-control" >
                    </div>
                    <div class="col-lg-2">
                        <button type="button" class="btn btn-danger btn-sm remove-fields">-</button>
                    </div>
       </div><br>
            `;
            $('#additional-fields-container').append(newFields);
        }

        // Click event handler for plus button
        $('.add-fields').click(function() {
            addFields();
        });

        // Click event handler for minus button (for dynamically added fields)
        $('#additional-fields-container').on('click', '.remove-fields', function() {
            $(this).closest('.row').remove();
        });
    });
</script>


      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <!-- Submit Button -->
        <button type="button" class="btn btn-primary" id="submitBtn">Submit</button>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function() {
    $('#exampleModalCheckbox').change(function() {
      if($(this).is(":checked")) {
        // Get customer name and email values
        var customerName = $('#customerName').val();
        var customerEmail = $('#customerEmail').val();
	
        // Display customer name and email in modal
        $('#modalCustomerName').text(customerName);
        $('#modalCustomerEmail').text(customerEmail);

        // Show the modal
        $('#exampleModal').modal('show');
      } else {
        // Hide the modal
        $('#exampleModal').modal('hide');
      }
    });
 $('#submitBtn').click(function() {
      // Serialize form data
      var formData = $('#exampleModal').find('input, select').serialize();
      
      // Send form data to server using AJAX
      $.ajax({
        type: 'POST',
        url: '/submit_form',
        data: formData,
        success: function(response) {
          // Display success message
          alert('Form submitted successfully!');
        },
        error: function(xhr, status, error) {
          // Display error message
          alert('Error occurred while submitting form.');
        }
      });
    });
  });
</script>


        </div>

        </div>
        </div>
            </div><br>
            <div class="container-fluid">
            <div class="card mb-4">
                                <div class="card-header">

                                            <i class="fas fa-table me-1"></i>
                                    Lab List

                                </div>
                                <div class="card-body">
                                    <table id="datatablesSimple">
                                        <thead>
                                            <tr>

                                                <th>Customer Name</th>
                                                <th> Start Date </th>
                                                <th>End Date</th>
                                                <th>Material</th>
                                                <th>Quantity</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>

                                                <th>Customer Name</th>
                                                <th> Start Date </th>
                                                <th>End Date</th>
                                                <th>Material</th>
                                                <th>Quantity</th>
                                                <th>Status</th>


                                            </tr>
                                        </tfoot>
                                        <tbody>
                                            {% for row in data %}
        <tr>



            <td>  <a href="elapproveview?id={{ row[0] }}" style="text-decoration: none;color: black">{{ row[1] }}</a>  </td>
            <td>{{ row[5] }}</td>
            <td> {{ row[6] }} </td>
            <td>
		     {% for serial in row[11] %}
        <p> {{ serial }} </p>
	{% endfor %}
	    </td>
	    
            <td>
		    {% for qqqty in row[12] %}
        <p> {{ qqqty }} </p>
        {% endfor %}

	    </td>
            <td>{{ row[10] }}</td>




        </tr>
        {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
</div>
            </div>

{% endblock %}

{% else %}
<script>
 // Display a SweetAlert message and logout after 5 seconds
 window.onload = function() {
     Swal.fire({
         title: 'Access Denied!',
         text: 'You are not allowed to view this page.',
         icon: 'warning',
         timer: 5000, // Automatically close the alert after 5 seconds
         timerProgressBar: true,
         showConfirmButton: false
     }).then((result) => {
         // Redirect to logout page after the alert is closed
         if (result.dismiss === Swal.DismissReason.timer) {
             window.location.href = "/logout";
         }
     });
 };
</script>
{% endif %}
